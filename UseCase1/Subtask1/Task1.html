<h1>Task 1.1 Synapse Pipeline with Copy Data Activity</h1>
<h2>Run Scenario:</h2>
<ol>
<li>Before starting the run scenario, clear <code>bronze/youflix</code> folder and re-create <code>YouFlixDB</code> database from
   scratch using <code>DeploymentScript.sql</code> script. It is necessary to get rid of the results of your previous execution
   and testing activities.</li>
<li>
<p>Go to data lake <code>stdimentoringdatalakexx</code> and proceed to Storage browser, then click on Tables and edit
   each of entity by setting watermark value to <code>2000-01-01T00:00:00.00Z</code>.
   <img alt="" src="./screenshots/watermark_table_entities.png" /></p>
</li>
<li>
<p>Take screenshot(s) of your pipeline.
   <img alt="" src="./screenshots/for-each-pipeline.png" />
   <img alt="" src="./screenshots/lookup-old-watermark-foreach.png" />
   <img alt="" src="./screenshots/lookup-new-watermark-foreach.png" />
   <img alt="" src="./screenshots/copy-data-foreach-source.png" />
   Source query:
   ```sql
   select </p>
<ul>
<li>from youflix.@{item().TABLE_NAME}
   where 
   created_timestamp &gt; cast('@{activity('LookupOldWatermark').output.firstRow.Watermark}' as datetime2) 
   and created_timestamp &lt;= cast('@{activity('LookupNewWatermark').output.firstRow.NewWatermarkvalue}' as datetime2)
   ```
   <img alt="" src="./screenshots/copy-data-foreach-sink.png" />
   <img alt="" src="./screenshots/update-watermark-source.png" />
   <img alt="" src="./screenshots/update-watermark-sink-foreach.png" />
   <img alt="" src="./screenshots/update-watermark-mapping-foreach.png" />
   <img alt="" src="./screenshots/generate-success-foreach-sink.png" />
   <img alt="" src="./screenshots/generate-success-foreach-source.png" /></li>
</ul>
</li>
<li>
<p>Go to your created pipeline and execute it manually.
   <img alt="" src="./screenshots/foreach-success.png" /></p>
</li>
<li>Once the job succeeds, check <code>bronze/youflix</code> folder, it should contain 4 folders and <code>Success.csv</code> file.</li>
<li>
<p>Take screenshot(s) of the target folder.
   <img alt="" src="./screenshots/success-foreach-files.png" /></p>
</li>
<li>
<p>Go inside each of 4 folders and take screenshot(s) of files generated.
   <img alt="" src="./screenshots/device-result.png" />
   <img alt="" src="./screenshots/subscription-result.png" />
   <img alt="" src="./screenshots/user-subscription-device-result.png" /></p>
</li>
<li>
<p>In Synapse Workspace, navigate to Data section, find in Linked tab your container, open <code>bronze/youflix</code>
   and select top 10 rows for each file using SQL queries.</p>
</li>
<li>
<p>Take screenshot(s) of SQL queries and result output.
   <img alt="" src="./screenshots/device-query.png" />
   <img alt="" src="./screenshots/subscription-query.png" />
   <img alt="" src="./screenshots/user-subscription-device-query.png" /></p>
</li>
<li>
<p>In Synapse Workspace, navigate to Data section, find in Linked tab your container, open <code>bronze/youflix</code>
    and check number of rows for each file using SQL query.</p>
</li>
<li>
<p>Take screenshot(s) of SQL queries with count values.
    <img alt="" src="./screenshots/subscription-count.png" />
    <img alt="" src="./screenshots/user-subscription-device-count.png" />
    <img alt="" src="./screenshots/device-count.png" /></p>
</li>
<li>
<p>Go to your Azure Table and take a screenshot of new watermark values.
    <img alt="" src="./screenshots/updated-watermark-table.png" /></p>
</li>
<li>
<p>Without changing source data, execute your pipeline one more time.</p>
</li>
<li>In Synapse Workspace, navigate to Data section, find in Linked tab your container, open <code>bronze/youflix</code>
    and check number of rows for each newly loaded file using SQL query.</li>
<li>
<p>Take screenshot(s) of SQL queries with count values.
    <img alt="" src="./screenshots/user-subscription-device-empty.png" />
    <img alt="" src="./screenshots/device-empty.png" />
    <img alt="" src="./screenshots/subscription-empty.png" /></p>
</li>
<li>
<p>Connect to MS SQL Server <code>YouFlixDB</code> database and run the following command:
    <code>sql
    EXEC youflix_internal.sp_youflix_tables_insert_update 10000, 15;</code>
    <img alt="" src="./screenshots/updating-onperm.png" /></p>
</li>
<li>
<p>Execute pipeline manually again.</p>
</li>
<li>In Synapse Workspace, navigate to Data section, find in Linked tab your container, open <code>bronze/youflix</code>
    and check number of rows for each newly loaded file using SQL query.</li>
<li>Take screenshot(s) of SQL queries with count values.
    <img alt="" src="./screenshots/user-subscription-device-count-after-rerun.png" /></li>
</ol>